<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="proyecto2.mtsolutions.dao.base.VeClientesDAO">

    <sql id="sqlCliente">
        select
            id_cliente idCliente,
            ruc ruc ,
            dv dv ,
            direccion direccion ,
            razon_social razonSocial ,
            email email ,
            es_juridico esJuridico ,
            telefono telefono ,
            usuario_creacion usuarioCreacion ,
            usuario_modificaicon usuarioModificaicon ,
            fecha_creacion fechaCreacion ,
            fecha_modificacion fechaModificacion
        from ve_clientes
    </sql>

    <select id="getLista" parameterType="Map" resultType="VeClientesDTO">
        <include refid="sqlCliente"/>
        limit #{cantidad} offset #{offset}
    </select>

    <select id="getListCount"  resultType="BigDecimal">
        select
        count(*)
        from ve_clientes
        where estado = true
    </select>

    <insert id="insert" parameterType="VeClientesDTO">
        INSERT INTO public.ve_clientes
        (
        ruc, 
        dv, 
        direccion, 
        razon_social, 
        email, 
        es_juridico, 
        telefono,
        usuario_creacion,
        usuario_modificaicon,
        fecha_creacion,
        fecha_modificacion)
        VALUES 
        (
        #{ruc}, 
        #{dv}, 
        #{direccion}, 
        #{razonSocial}, 
        #{email}, 
        #{esJuridico}, 
        #{telefono}, 
        #{usuarioCreacion}, 
        #{usuarioModificaicon}, 
        #{fechaCreacion}, 
        #{fechaModificacion}); 
    </insert>

    <update id="update" >
        UPDATE public.ve_clientes
        SET ruc = #{ruc},
            dv #{dv},
            direccion = #{direccion},
            razon_social = #{razonSocial},
            email = #{email},
            es_juridico = #{esJuridico},
            telefono = #{telefono},
            usuario_modificaicon = #{usuarioModificaicon},
            fecha_modificacion = #{fechaModificacion}
        WHERE ruc = #{ruc}
    </update>

    <select id="getById" parameterType="Map" resultType="VeClientesDTO">
        <include refid="sqlCliente"/>
        where id_cliente = #{idCliente}
    </select>

    <select id="buscar" parameterType="Map" resultType="VeClientesDTO">
        <bind name="fil" value="'%' + filtro.valor + '%'" />
        <include refid="sqlCliente"></include>
        where
        lower(nombre) like lower(#{fil})
        or lower(ruc) like lower(#{fil})
        or lower(direccion) like lower(#{fil})
        or lower(correo) like lower(#{fil})
        or lower(usuario_creacion) like lower(#{fil})
        order by fecha_creacion desc limit #{cantidad} offset #{offset}
    </select>

    <select id="yaExiste" parameterType="VeClientesDTO" resultType="java.lang.Boolean">
        select case
        when ruc is null then false
        else true
        end resultado
        from (select ruc from ve_clientes vc where vc.ruc = UPPER(#{ruc}) ) t
    </select>


</mapper>